<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIVA - Your Voice Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Roboto:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy: #0A1D37;
            --accent: #4A90E2;
            --pastel-blue: #A0D8F1;
            --pastel-pink: #FFD3E0;
            --bg: #F8FBFF;
            --card: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 25px rgba(10, 29, 55, 0.12);
            --gradient: linear-gradient(135deg, #0A1D37, #1E3A5F);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: var(--navy);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Changed to start for scrollable */
            overflow-y: auto; /* Allow scrolling */
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(74, 144, 226, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 211, 224, 0.1) 0%, transparent 20%);
        }

        #app {
            width: 100%;
            max-width: 520px;
            margin: 20px;
            background: var(--card);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        /* Landing - Full page scrollable */
        #landing {
            padding: 60px 40px;
            text-align: center;
            background: var(--gradient);
            color: white;
            min-height: 100vh; /* Full viewport */
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        #landing h1 {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            font-size: 5rem;
            margin-bottom: 24px;
            background: linear-gradient(90deg, #FFD3E0, #A0D8F1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -2px;
        }

        #landing .description {
            font-family: 'Pacifico', cursive;
            font-size: 1.4rem;
            line-height: 1.8;
            margin-bottom: 48px;
            opacity: 0.95;
            max-width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        /* Features Section - Roadmap style */
        #features {
            margin: 40px 0;
            text-align: left;
        }

        #features h2 {
            font-size: 1.8rem;
            margin-bottom: 24px;
            color: white;
        }

        .feature-list {
            list-style: none;
            position: relative;
            padding-left: 40px;
        }

        .feature-list::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255, 255, 255, 0.3);
        }

        .feature-item {
            position: relative;
            margin-bottom: 32px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s forwards;
        }

        .feature-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent);
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.2);
        }

        .feature-item h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .feature-item p {
            font-size: 1rem;
            opacity: 0.8;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Stagger animations */
        .feature-item:nth-child(1) { animation-delay: 0.2s; }
        .feature-item:nth-child(2) { animation-delay: 0.4s; }
        .feature-item:nth-child(3) { animation-delay: 0.6s; }
        .feature-item:nth-child(4) { animation-delay: 0.8s; }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1.5px solid rgba(255, 255, 255, 0.3);
            padding: 14px 28px;
            margin: 8px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .btn:hover {
            background: white;
            color: var(--navy);
            transform: translateY(-2px);
        }

        /* Forms */
        .form-container {
            display: none;
            padding: 40px;
            background: white;
        }

        .form-container h2 {
            text-align: center;
            margin-bottom: 32px;
            color: var(--navy);
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--navy);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 14px;
            border: 1.5px solid #ddd;
            border-radius: 12px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.15);
        }

        .error {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 6px;
            min-height: 20px;
        }

        .switch-link {
            text-align: center;
            color: var(--accent);
            cursor: pointer;
            font-weight: 500;
            margin-top: 16px;
        }

        /* Main Dashboard */
        #main {
            display: none;
            height: 80vh;
            flex-direction: column;
        }

        #header {
            padding: 20px;
            background: var(--gradient);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #header h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        #logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        #chat-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.5;
            font-size: 1rem;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background: var(--accent);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .niva-message {
            align-self: flex-start;
            background: #f0f2f5;
            color: var(--navy);
            border-bottom-left-radius: 4px;
        }

        #input-area {
            padding: 16px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        #user-input {
            flex: 1;
            padding: 14px 18px;
            border: 1.5px solid #ddd;
            border-radius: 30px;
            font-size: 1rem;
        }

        #user-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        #mic-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }

        #mic-btn.active {
            background: #e74c3c;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); }
            70% { transform: scale(1.05); }
            100% { transform: scale(0.95); }
        }

        #send-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
        }

        #spinner {
            text-align: center;
            color: var(--accent);
            font-style: italic;
            display: none;
            padding: 10px;
        }

        @media (max-width: 480px) {
            #app { margin: 10px; }
            #landing h1 { font-size: 3rem; }
            .message { max-width: 90%; }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Landing -->
        <div id="landing">
            <h1>NIVA</h1>
            <p class="description">NIVA is your friendly voice assistant. She answers with warmth, tells time & date, and lifts your spirit with affirmations. Sign up or log in to start talking!</p>
            
            <!-- Features Roadmap -->
            <div id="features">
                <h2>Our Features</h2>
                <ul class="feature-list">
                    <li class="feature-item">
                        <h3>Voice Interaction</h3>
                        <p>Speak naturally and get spoken responses.</p>
                    </li>
                    <li class="feature-item">
                        <h3>Mood Detection</h3>
                        <p>Empathetic replies based on how you feel.</p>
                    </li>
                    <li class="feature-item">
                        <h3>Calculations</h3>
                        <p>Perform simple math operations on the fly.</p>
                    </li>
                    <li class="feature-item">
                        <h3>Affirmations & Jokes</h3>
                        <p>Get motivated or have a laugh anytime.</p>
                    </li>
                </ul>
            </div>
            
            <button class="btn" id="create-btn">Create Account</button>
            <button class="btn" id="signin-btn">Sign In</button>
        </div>

        <!-- Register -->
        <div id="register-form" class="form-container">
            <h2>Create Account</h2>
            <div class="form-group">
                <label for="reg-username">Username</label>
                <input type="text" id="reg-username" placeholder="Choose a username (3+ chars)">
                <div class="error" id="reg-username-error"></div>
            </div>
            <div class="form-group">
                <label for="reg-password">Password</label>
                <input type="password" id="reg-password" placeholder="Min 8 chars, 1 number, 1 special">
                <div class="error" id="reg-password-error"></div>
            </div>
            <div class="form-group">
                <label for="reg-confirm">Confirm Password</label>
                <input type="password" id="reg-confirm">
                <div class="error" id="reg-confirm-error"></div>
            </div>
            <button class="btn" id="register-submit" style="width:100%; margin-top:10px;">Register</button>
            <div class="switch-link" id="switch-to-login">Already have an account? Sign In</div>
        </div>

        <!-- Login -->
        <div id="login-form" class="form-container">
            <h2>Sign In</h2>
            <div class="form-group">
                <label for="login-username">Username</label>
                <input type="text" id="login-username">
                <div class="error" id="login-username-error"></div>
            </div>
            <div class="form-group">
                <label for="login-password">Password</label>
                <input type="password" id="login-password">
                <div class="error" id="login-password-error"></div>
            </div>
            <button class="btn" id="login-submit" style="width:100%; margin-top:10px;">Login</button>
            <div class="switch-link" id="switch-to-register">No account? Create one</div>
        </div>

        <!-- Main Chat -->
        <div id="main">
            <div id="header">
                <h2>NIVA</h2>
                <button id="logout-btn">Logout</button>
            </div>
            <div id="chat-container"></div>
            <div id="spinner">NIVA is thinking...</div>
            <div id="input-area">
                <button id="mic-btn" aria-label="Speak to NIVA">ðŸŽ¤</button>
                <input type="text" id="user-input" placeholder="Type or speak...">
                <button id="send-btn">Send</button>
            </div>
        </div>
    </div>

    <script>
        // === DOM ELEMENTS ===
        const els = {
            landing: document.getElementById('landing'),
            register: document.getElementById('register-form'),
            login: document.getElementById('login-form'),
            main: document.getElementById('main'),
            chat: document.getElementById('chat-container'),
            input: document.getElementById('user-input'),
            mic: document.getElementById('mic-btn'),
            send: document.getElementById('send-btn'),
            spinner: document.getElementById('spinner')
        };

        // === STATE ===
        const memory = {
            username: '',
            userMood: 'neutral',
            knowsName: false,
            askedName: false,
            greetingDone: false
        };

        // === SPEECH ===
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = SpeechRecognition ? new SpeechRecognition() : null;
        const synth = window.speechSynthesis;

        // === DATA ===
        const affirmations = [
            "You're doing better than you think â€” keep going!",
            "Every small step counts. You're on the right path.",
            "Your presence makes the world brighter.",
            "You're stronger than yesterday.",
            "Today is full of possibilities for you.",
            "You deserve peace, love, and happiness."
        ];

        const jokes = [
            "Why don't eggs tell jokes? They'd crack each other up!",
            "I told my computer I needed a break, and now it won't stop sending me KitKat ads.",
            "Why did the math book look sad? Because it had too many problems."
        ];

        // === INIT ===
        if (localStorage.getItem('loggedIn') === 'true') {
            memory.username = localStorage.getItem('username') || '';
            showMain();
        } else {
            showLanding();
        }

        // === EVENT LISTENERS ===
        document.getElementById('create-btn').onclick = () => showForm('register');
        document.getElementById('signin-btn').onclick = () => showForm('login');
        document.getElementById('switch-to-login').onclick = () => showForm('login');
        document.getElementById('switch-to-register').onclick = () => showForm('register');
        document.getElementById('register-submit').onclick = register;
        document.getElementById('login-submit').onclick = login;
        document.getElementById('logout-btn').onclick = logout;
        els.send.onclick = sendMessage;
        els.input.addEventListener('keypress', e => e.key === 'Enter' && sendMessage());
        els.mic.onclick = startVoice;

        // === FUNCTIONS ===
        function showLanding() {
            els.landing.style.display = 'flex';
            hideAll(['register', 'login', 'main']);
        }

        function showForm(form) {
            hideAll(['landing', 'register', 'login', 'main']);
            els[form].style.display = 'block';
            clearErrors();
        }

        function hideAll(ids) {
            ids.forEach(id => {
                if (els[id]) els[id].style.display = 'none';
            });
        }

        function clearErrors() {
            document.querySelectorAll('.error').forEach(el => el.textContent = '');
        }

        function showMain() {
            hideAll(['landing', 'register', 'login']);
            els.main.style.display = 'flex';
            if (!memory.greetingDone) greetUser();
        }

        function register() {
            const username = document.getElementById('reg-username').value.trim();
            const pass = document.getElementById('reg-password').value;
            const confirm = document.getElementById('reg-confirm').value;

            clearErrors();
            let valid = true;

            if (username.length < 3) { error('reg-username-error', 'Username too short'); valid = false; }
            if (!/(?=.*\d)(?=.*[!@#$%^&*])[\w!@#$%^&*]{8,}/.test(pass)) {
                error('reg-password-error', 'Need 8+ chars, 1 number, 1 special');
                valid = false;
            }
            if (pass !== confirm) { error('reg-confirm-error', "Passwords don't match"); valid = false; }

            if (valid) {
                localStorage.setItem('username', username);
                localStorage.setItem('password', pass);
                localStorage.setItem('loggedIn', 'true');
                memory.username = username;
                showMain();
            }
        }

        function login() {
            const username = document.getElementById('login-username').value.trim();
            const pass = document.getElementById('login-password').value;
            const storedUser = localStorage.getItem('username');
            const storedPass = localStorage.getItem('password');

            if (username === storedUser && pass === storedPass) {
                localStorage.setItem('loggedIn', 'true');
                memory.username = username;
                showMain();
            } else {
                error('login-username-error', 'Invalid credentials');
            }
        }

        function logout() {
            localStorage.setItem('loggedIn', 'false');
            Object.keys(memory).forEach(k => memory[k] = k === 'userMood' ? 'neutral' : false);
            memory.greetingDone = false;
            showLanding();
        }

        function error(id, msg) {
            document.getElementById(id).textContent = msg;
        }

        function sendMessage() {
            const text = els.input.value.trim();
            if (!text) return;
            addMessage('user', text);
            els.input.value = '';
            processInput(text);
        }

        function startVoice() {
            if (!recognition) return alert('Voice not supported. Type instead.');
            els.mic.classList.add('active');
            recognition.start();

            recognition.onresult = e => {
                const transcript = e.results[0][0].transcript;
                els.input.value = transcript;
                els.mic.classList.remove('active');
                sendMessage();
            };

            recognition.onerror = () => {
                els.mic.classList.remove('active');
                alert('Voice error. Try typing.');
            };
        }

        function processInput(input) {
            els.spinner.style.display = 'block';
            const lower = input.toLowerCase().replace(/[?!.]/g, '');

            let response = '';

            // Natural language math
            let calcInput = input;
            if (lower.includes('what is') || lower.includes('calculate')) {
                calcInput = input.replace(/what is|calculate/i, '').trim();
            }

            // === MATH CALCULATION ===
            const mathMatch = calcInput.match(/(\d+\.?\d*)\s*([+\-*/])\s*(\d+\.?\d*)/);
            if (mathMatch) {
                const num1 = parseFloat(mathMatch[1]);
                const op = mathMatch[2];
                const num2 = parseFloat(mathMatch[3]);
                let result;

                switch (op) {
                    case '+': result = num1 + num2; break;
                    case '-': result = num1 - num2; break;
                    case '*': result = num1 * num2; break;
                    case '/': result = num2 !== 0 ? num1 / num2 : "âˆž (can't divide by zero)"; break;
                }

                if (typeof result === 'number') {
                    result = result % 1 === 0 ? result : result.toFixed(2);
                }
                response = `Result: ${num1} ${op} ${num2} = ${result}`;
            }
            // === END MATH ===

            else if (!memory.knowsName && /my name is (\w+)/.test(lower)) {
                const name = lower.match(/my name is (\w+)/)[1];
                memory.username = name.charAt(0).toUpperCase() + name.slice(1);
                memory.knowsName = true;
                response = `Nice to meet you, ${memory.username}! How are you feeling today?`;
            }
            else if (!memory.greetingDone) {
                response = `Hi ${memory.username || 'there'}! I'm NIVA. What's on your mind?`;
                memory.greetingDone = true;
            }
            else if (lower.includes('sad') || lower.includes('down')) {
                memory.userMood = 'sad';
                response = "I'm really sorry. Want to talk about it? I'm here.";
            }
            else if (lower.includes('happy') || lower.includes('great')) {
                memory.userMood = 'happy';
                response = "That makes me happy too! What's the good news?";
            }
            else if (lower.includes('time')) {
                response = `It's ${new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}.`;
            }
            else if (lower.includes('date')) {
                response = `Today is ${new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}.`;
            }
            else if (lower.includes('affirmation') || lower.includes('motivate')) {
                response = affirmations[Math.floor(Math.random() * affirmations.length)];
            }
            else if (lower.includes('joke')) {
                response = jokes[Math.floor(Math.random() * jokes.length)];
            }
            else if (memory.userMood === 'sad') {
                response = "I'm still here. Want a hug? Hug. Or I can share something positive.";
            }
            else {
                response = `You said: "${input}". Tell me more!`;
                if (!memory.askedName && Math.random() > 0.6) {
                    response += " By the way, what's your name?";
                    memory.askedName = true;
                }
            }

            setTimeout(() => {
                addMessage('niva', response);
                speak(response);
                els.spinner.style.display = 'none';
            }, 600);
        }

        function greetUser() {
            setTimeout(() => {
                addMessage('niva', `Welcome, ${memory.username || 'friend'}! I'm NIVA. How can I help?`);
                speak(`Welcome, ${memory.username || 'friend'}!`);
            }, 500);
        }

        function addMessage(sender, text) {
            const div = document.createElement('div');
            div.className = `message ${sender}-message`;
            div.textContent = text;
            els.chat.appendChild(div);
            els.chat.scrollTop = els.chat.scrollHeight;
        }

        function speak(text) {
            if (!synth) return;
            const utter = new SpeechSynthesisUtterance(text);
            utter.rate = 0.9;
            utter.pitch = 1.1;
            synth.speak(utter);
        }
    </script>
</body>
</html>